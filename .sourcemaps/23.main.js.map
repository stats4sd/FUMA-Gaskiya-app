{"version":3,"sources":["../../src/pages/tabs/profile/profile.module.ts","../../src/pages/tabs/profile/profile.ts"],"names":[],"mappings":"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","file":"23.main.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ProfilePage } from './profile';\r\n//import { TranslationModule } from '../../../translation/translate.module'\r\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\r\n\r\n@NgModule({\r\n  declarations: [ProfilePage],\r\n  imports: [TranslateModule, IonicPageModule.forChild(ProfilePage)],\r\n  exports: [ProfilePage]\r\n})\r\nexport class ProfilePageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/tabs/profile/profile.module.ts","import { Component } from '@angular/core';\r\nimport { NavController, NavParams, ModalController, ToastController, IonicPage } from 'ionic-angular';\r\nimport { PouchdbProvider } from '../../../providers/pouchdb-provider';\r\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\r\nimport { TranslateService  } from '@ngx-translate/core';\r\nimport { global } from '../../../global-variables/variable'\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-profile',\r\n  templateUrl: 'profile.html'\r\n})\r\nexport class ProfilePage {\r\n  profiles: any;\r\n  allProfiles: any;\r\n  empty: boolean;\r\n  photos: any;\r\n  photoArray: any[] = [];\r\n  deletedMessage: boolean = false\r\n\r\n  constructor(public trnaslate: TranslateService, public navCtrl: NavController, public navParams: NavParams, public toastCtrl:ToastController, public modalCtrl: ModalController, private database: PouchdbProvider, private sanitizer: DomSanitizer) { \r\n    this.trnaslate.setDefaultLang(global.langue)\r\n  }\r\n\r\n  ionViewDidEnter() {\r\n    this.trnaslate.use(global.langue)\r\n    this.getProfiles();\r\n    this.deletedMessage = false;\r\n    //this.getPhotos();\r\n  }\r\n  viewProfile(profile) {\r\n    console.log('viewing profile', profile)\r\n    let formModal = this.modalCtrl.create('ProfileViewPage', profile, {\r\n      showBackdrop: false,\r\n      enableBackdropDismiss: false\r\n    });\r\n    // add functions to delete doc and linked photos if prompted from modal\r\n    formModal.onDidDismiss(data => {\r\n      console.log('dismissed data', data)\r\n      if (data && data.deleteDoc) {\r\n        this.database.remove(profile.id)\r\n        this.deletedMessage = true;\r\n        if (profile.photoDocId && profile.photoDocId!=\"\") {\r\n          this.database.remove(profile.photoDocId)\r\n        }\r\n        this.showToast('user deleted')\r\n\r\n      }\r\n    });\r\n    formModal.present();\r\n  }\r\n  getProfiles() {\r\n    this.database.getAll(\r\n      {\r\n        startkey: 'koboSubmission_fuma-op-membre',\r\n        endkey: 'koboSubmission_fuma-op-membre\\uffff',\r\n        include_docs: true\r\n      },\r\n    ).then(\r\n      res => {\r\n        var profiles = res.rows\r\n        var promises = profiles.map(function (profile) {\r\n          return this.getPhoto(profile)\r\n        }.bind(this))\r\n        return Promise.all(promises).then(\r\n          res => {\r\n            this.profiles = res\r\n            this.allProfiles=res\r\n          }\r\n        )\r\n      }\r\n      )\r\n  }\r\n\r\n  getPhoto(profile) {\r\n    return new Promise((resolve, reject) => {\r\n      var profilePhotoId = profile.doc.data[\"meta/deprecatedID\"]\r\n      var photoDocId = 'photos_fuma-op-membre/' + profilePhotoId\r\n      var filename = profilePhotoId + '.jpeg'\r\n      // return 'assets/images/no photo.jpg'\r\n      this.database.getAttachment('photos_fuma-op-membre/' + profilePhotoId, filename).then(url => {\r\n        profile.photo = this.sanitizer.bypassSecurityTrustUrl(url)\r\n        if (url != \"assets/images/no-photo.png\") {\r\n          profile.photoDocId = photoDocId;\r\n        }  \r\n        resolve(profile)\r\n      }).catch(err => {\r\n        console.log('err', err)\r\n        // profile.photo = \r\n        // resolve(profile)\r\n      })\r\n    })\r\n  }\r\n  initializeItems() {\r\n    this.profiles = this.allProfiles;\r\n  }\r\n  getItems(ev: any) {\r\n    // Reset items back to all of the items\r\n    this.initializeItems();\r\n\r\n    // set val to the value of the searchbar\r\n    let val = ev.target.value;\r\n\r\n    // if the value is an empty string don't filter the items\r\n    if (val && val.trim() != '') {\r\n      this.profiles = this.profiles.filter((item) => {\r\n        return (item.doc.data.nom_Membre.toLowerCase().indexOf(val.toLowerCase()) > -1);\r\n      })\r\n    }\r\n  }\r\n  showFilters() {\r\n    this.showToast('filters not yet implemented')\r\n  }\r\n  showToast(message, position='top') {\r\n    let toast = this.toastCtrl.create({\r\n      message: message,\r\n      duration: 3000,\r\n      position: position\r\n    });\r\n    toast.present();\r\n  }\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/tabs/profile/profile.ts"],"sourceRoot":""}