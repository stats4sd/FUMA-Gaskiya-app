{"version":3,"sources":["../../src/pages/security/register/register.ts","../../src/pages/security/register/register.module.ts"],"names":[],"mappings":"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","file":"28.js","sourcesContent":["import { Component } from '@angular/core';\nimport { NavController, ViewController, NavParams, LoadingController, IonicPage, MenuController, ToastController } from 'ionic-angular';\n//import { TabsPage } from '../tabs/tabs';\n//import { LoginPage } from '../login/login';\n//import { ConfigBoutiquePage } from '../accueil/config-boutique/config-boutique';\nimport { PouchdbProvider } from '../../../providers/pouchdb-provider';\nimport { Validators, FormBuilder } from '@angular/forms';\nimport { Storage } from '@ionic/storage';\nimport { TranslateService } from '@ngx-translate/core';\nimport { global } from '../../../global-variables/variable';\n\n/*\n  Generated class for the Register page.\n\n  See http://ionicframework.com/docs/v2/components/#navigation for more info on\n  Ionic pages and navigation.\n*/\n@IonicPage()\n@Component({\n  selector: 'page-register',\n  templateUrl: 'register.html'\n})\nexport class RegisterPage {\n\n  //nom: string;\n  //username: string;\n  //email: string;\n  mdpass: string;\n  confmdpass: string;\n  registerForm: any;\n\n  constructor(public translate: TranslateService, public viewCtl:ViewController, public toastCtl: ToastController, public navCtrl: NavController, public storage: Storage, public menuCtrl: MenuController, public formBuilder: FormBuilder, public navParams: NavParams, public loadinCtl: LoadingController, public gestionService: PouchdbProvider) {\n    this.translate.setDefaultLang(global.langue);\n    let d: Date = new Date();\n    let s = this.createDate(d.getDate(), d.getMonth(), d.getFullYear());\n    this.registerForm = this.formBuilder.group({\n        nom: [''],\n        username: ['', Validators.required],\n        email: [''],\n        mdpass: ['', Validators.required],\n        confmdpass: ['', Validators.required],\n        date: [s, Validators.required],\n        sex: ['', Validators.required], \n        created_at: [d.toJSON()],\n        updatet_at: [d.toJSON()],\n        created_by: [''],\n        updated_by: [''],\n        //deleted_at: [d.toJSON()],\n        //deleted_by: [d.toJSON()],\n    });\n  }\n\n     dismiss(){\n    this.viewCtl.dismiss();\n  }\n\n  afficheMsg(msg: string){\n    let toast = this.toastCtl.create({\n      message: msg,\n      position: 'top',\n      duration: 3000\n    });\n\n    toast.present();\n  }\n\n  createDate(jour: any, moi: any, annee: any){\n    let s = annee+'-';\n    moi += 1;\n    if(moi < 10){\n      s += '0'+moi+'-';\n    }else{\n      s += moi+'-';\n    }\n\n    if(jour < 10){\n      s += '0'+jour;\n    }else{\n      s += jour;\n    }\n    return s;\n  }\n\n\n  ionViewWillEnter() {\n    this.translate.use(global.langue);\n    console.log('ionViewDidLoad RegisterPage');\n  }\n\n  register(){\n    if(this.mdpass !== this.confmdpass){\n      alert('Le mot de passe et la confirmation ne sont pas conformes.');\n      this.confmdpass = '';\n    }else{\n      //this.gestionService.logout();\n      let user = this.registerForm.value;\n      let meta = {\n        nom: user.nom,\n        email: user.email,\n        date: user.date,\n        sex: user.sex\n      }\n \n\n      let loading = this.loadinCtl.create({\n        content: 'Enregistrement...'\n      });\n      loading.present();\n\n      //let db = new PouchDB('http://localhost:5984/stock-fuma');\n      this.gestionService.remoteSaved.signup(user.username, user.mdpass,{metadata : meta}, (err, response) => {\n        if(err){\n          loading.dismissAll();\n          if (err.name === 'conflict') {\n              alert('Nom utilisateur existe déjà');\n            }else  if (err.name === 'forbidden') {\n              alert('Nom utilisateur invalide');\n            } else{\n              alert('Une erreur s\\'est produite lors de la tentative de connexion au serveur');\n            }\n        }else if(response){\n          loading.dismissAll();\n          this.afficheMsg('Compte créé avec succèes');\n          this.loginUser(user.username, user.mdpass)\n          this.navCtrl.pop();\n          //this.navCtrl.setRoot(TabsPage);\n        }else{\n          loading.dismissAll();\n          alert('echec d\\'authentification');\n        }\n          \n      });\n    }\n    \n  }\n\n  login(){\n    this.navCtrl.push('LoginPage');\n  }\n\n loginUser(username: any, mdpass: any){\n    let loading = this.loadinCtl.create({\n      content: 'Connexion...'\n    });\n    loading.present();\n    let ajaxOpts = {\n      ajax: {\n        headers: {\n          Authorization: 'Basic ' + window.btoa(username + ':' + mdpass)\n        }\n      }\n    };\n    this.gestionService.remoteSaved.login(username, mdpass, ajaxOpts, (err, response) => {\n      let user: any = {\n        'username': username,\n        'mdpass': mdpass\n      }\n      if (err) {\n        loading.dismissAll();\n        if (err.name === 'unauthorized') {\n          alert('nom ou mot de passe incorrecte');\n          \n        } else {\n          alert('erreur');\n          \n        }\n      }else if(response){\n        \n        //alert('success');\n        //this.MyApp.setPage();\n        //let m = MyApp.g\n        //m.setPage();\n        this.storage.set('info_connexion', user);\n        global.info_connexion = user;\n        this.gestionService.remoteSaved.getUser(username, (err, us) => {\n          if (err) {\n            if (err.name === 'not_found') {\n              // typo, or you don't have the privileges to see this user\n              alert('Privilèges insuffiasants');\n            } else {\n              // some other error\n              alert('Erreur');\n            }\n          } else {\n            // response is the user object\n           this.storage.set('info_user', us);\n           global.info_user = us;\n          }\n        });\n        loading.dismissAll();\n       /* if(global.configOK == false){\n          this.enableAuthenticatedMenu();\n          this.navCtrl.push(ConfigBoutiquePage);\n        }else{\n          this.enableAuthenticatedMenu();\n          this.navCtrl.setRoot(TabsPage);\n        }*/\n        \n        \n  \n      }else{ \n        loading.dismissAll();\n        alert('echec');\n      }\n    });\n  }\n\n  enableAuthenticatedMenu() {\n    this.menuCtrl.enable(true, 'authenticated');\n    this.menuCtrl.enable(false, 'unauthenticated');\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/security/register/register.ts","import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { RegisterPage } from './register';\r\n///import { TranslationModule } from '../../../translation/translate.module'\r\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\r\n\r\n@NgModule({\r\n  declarations: [RegisterPage],\r\n  imports: [TranslateModule, IonicPageModule.forChild(RegisterPage)],\r\n  exports: [RegisterPage]\r\n})\r\nexport class RegisterPageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/security/register/register.module.ts"],"sourceRoot":""}