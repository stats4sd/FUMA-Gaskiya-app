{"version":3,"sources":["../../src/pages/research-view/research-view.module.ts","../../src/pages/research-view/research-view.ts"],"names":[],"mappings":"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","file":"36.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ResearchViewPage } from './research-view';\r\n//import { TranslationModule } from '../../translation/translate.module'\r\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\r\n\r\n@NgModule({\r\n  declarations: [ResearchViewPage],\r\n  imports: [TranslateModule, IonicPageModule.forChild(ResearchViewPage)],\r\n  exports: [ResearchViewPage]\r\n})\r\nexport class ResearchViewPageModule { }\r\n \n\n\n// WEBPACK FOOTER //\n// ./src/pages/research-view/research-view.module.ts","import { Component } from '@angular/core';\r\nimport { NavController, NavParams, ModalController, IonicPage } from 'ionic-angular';\r\n//import { VegaLitePage } from '../visualisations/vega-lite/vega-lite';\r\n//import { LeafletPage } from '../visualisations/leaflet/leaflet';\r\nimport { PouchdbProvider } from '../../providers/pouchdb-provider'\r\nimport { TranslateService  } from '@ngx-translate/core';\r\nimport { global } from '../../global-variables/variable'\r\n//simple statistics imported in index.html\r\ndeclare var ss;\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-research-view',\r\n  templateUrl: 'research-view.html'\r\n})\r\nexport class ResearchViewPage {\r\n  public res: any;\r\n  private submissions: any;\r\n  private id: any;\r\n  private count: any;\r\n  summaries:any=[]\r\n\r\n  constructor(public translate: TranslateService, public navCtrl: NavController, public navParams: NavParams, public modalCtrl: ModalController, private database:PouchdbProvider) {\r\n    this.translate.setDefaultLang(global.langue)\r\n    this.res = this.navParams.data.doc;\r\n    this.id = this.navParams.data.id\r\n    this.refresh()\r\n    this.count=1\r\n  }\r\n  refresh() {\r\n    if (this.id.split('_')[0] == \"koboForms\") {\r\n      this.prepareKoboFormSummaries(this.res)\r\n    }\r\n    else { this.calculateSummaries(this.res.summaries, this.res.data) }\r\n  }\r\n\r\n  ionViewDidEnter() {\r\n    this.translate.use(global.langue)\r\n    if(this.count>0){this.refresh()}\r\n  }\r\n  prepareKoboFormSummaries(doc) {\r\n    if (!doc.summaries) { doc.summaries = [] }\r\n    if (!doc.visualisations) { doc.visualisations = [] }\r\n    this.res = doc\r\n    //get data points\r\n    var key = 'koboSubmission_' + doc.id_string\r\n    this.database.getAll(\r\n      {\r\n        startkey: key,\r\n        endkey: key + '\\uffff',\r\n        include_docs: true\r\n      },\r\n    ).then(\r\n      res => {\r\n        var data = []\r\n        for (let row of res.rows) {\r\n          data.push(row.doc.data)\r\n        }\r\n        this.res.data = data\r\n        console.log('current res', this.res)\r\n        let i = 0\r\n        for (let vis of doc.visualisations) {\r\n          this.res.visualisations[i].spec.data = this.res.data\r\n        }\r\n        this.calculateSummaries(this.res.summaries, this.res.data)\r\n      })  \r\n  }\r\n\r\n  openVis(vis) {\r\n    console.log(vis)\r\n\r\n    //set additional parameters and load relevant vis page, sending spec parameter as 'visSpec'\r\n    if (vis.type == \"vega-lite\") {\r\n      let spec = vis.spec\r\n      //copy description and data to spec \r\n      spec.data = {\r\n        values: this.res.data\r\n      }    \r\n      spec.description = vis.description\r\n      let modal = this.modalCtrl.create('VegaLitePage', { visSpec: spec });\r\n      modal.present();\r\n    }\r\n    if (vis.type == \"leaflet\") {\r\n      vis.data=this.res.data\r\n      let modal = this.modalCtrl.create('LeafletPage', vis);\r\n      modal.present();}  \r\n  }\r\n  calculateSummaries(summaries, data) {\r\n    console.log('summaries', summaries);\r\n    console.log('data', data);\r\n    for (let summary of summaries) {\r\n      summary.dataArray=this._getDataArray(summary,data)\r\n      console.log(summary)\r\n      if (summary.metric == \"count\") { this._summaryCount(summary, data) }\r\n      if (summary.metric == \"unique\") { this._summaryUnique(summary, data) }\r\n      if (summary.metric == \"mean\") { this._summaryMean(summary, data) }\r\n    }\r\n  }\r\n  _summaryCount(summary, data) {\r\n    let count=0\r\n    for (let item of data) { count++ }\r\n    summary.value = count\r\n    this.summaries.push(summary)\r\n  }\r\n  _summaryUnique(summary, data) {\r\n    let temp = {}\r\n    var uniqueField=summary.field\r\n    for (let item of data) {\r\n      if (!temp[item[uniqueField]]) { temp[item[uniqueField]] = 0 }\r\n      temp[item[uniqueField]]++\r\n    }\r\n    console.log('unique keys',temp)\r\n    summary.value = Object.keys(temp).length\r\n    this.summaries.push(summary)\r\n  }\r\n  _summaryMean(summary, data) {\r\n    summary.value = ss.mean(summary.dataArray)\r\n    this.summaries.push(summary)\r\n  }\r\n  _getDataArray(summary, data) {\r\n    var temp = []\r\n    for (let item of data) {\r\n      if ([item[summary.field]]){\r\n        temp.push(item[summary.field])\r\n      }\r\n    }\r\n    return temp\r\n  }\r\n\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/research-view/research-view.ts"],"sourceRoot":""}